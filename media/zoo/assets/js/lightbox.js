/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function($){var plugin,tmp,loading,overlay,wrap,outer,content,close,title,nav_left,nav_right,body_margin,selectedIndex=0,selectedOpts={},selectedArray=[],currentIndex=0,currentOpts={},currentArray=[],ajaxLoader=null,imgPreloader=new Image,loadingTimer,loadingFrame=1,imgRegExp=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,swfRegExp=/[^\.]\.(swf)\s*$/i,youtubeRegExp=/(\/\/.*?youtube\.[a-z]+)\/watch\?v=([^&]+)&?(.*)/,youtubeRegExp2=/youtu\.be\/(.*)/,vimeoRegExp=/(\/\/.*?)vimeo\.[a-z]+\/([0-9]+).*?/,videoRegExp=/\.(mp4|ogv|webm|flv)(.*)?$/i,titleHeight=0,titleStr="",start_pos,final_pos,busy=!1,fx=$.extend($("<div/>")[0],{prop:0});_abort=function(){loading.hide(),imgPreloader.onerror=imgPreloader.onload=null,ajaxLoader&&ajaxLoader.abort(),tmp.empty()},_error=function(){if(!1===selectedOpts.onError(selectedArray,selectedIndex,selectedOpts))return loading.hide(),void(busy=!1);selectedOpts.titleShow=!1,selectedOpts.width="auto",selectedOpts.height="auto",tmp.html('<p id="lightbox-error">The requested content cannot be loaded.<br />Please try again later.</p>'),_process_inline()},_start=function(){var obj=selectedArray[selectedIndex],href,type,title,str,emb,ret,parts,href,type;if(_abort(),selectedOpts=$.extend({},plugin.defaults,void 0===$(obj).data(plugin.name)?selectedOpts:$(obj).data(plugin.name)),$(obj).attr("data-lightbox")&&$.each($(obj).attr("data-lightbox").split(";"),function(i,option){var opt=option.match(/\s*([A-Z_]*?)\s*:\s*(.+)\s*/i);opt&&(selectedOpts[opt[1]]=opt[2],"true"!==selectedOpts[opt[1]]&&"false"!==selectedOpts[opt[1]]||(selectedOpts[opt[1]]=eval(opt[2])))}),ret=("string"==typeof selectedOpts.onStart?window[selectedOpts.onStart]:selectedOpts.onStart)(selectedArray,selectedIndex,selectedOpts),!1!==ret)if("object"==typeof ret&&(selectedOpts=$.extend(selectedOpts,ret)),title=selectedOpts.title||(obj.nodeName?$(obj).attr("title"):obj.title)||"",obj.nodeName&&!selectedOpts.orig&&(selectedOpts.orig=$(obj).children("img:first").length?$(obj).children("img:first"):$(obj)),""===title&&selectedOpts.orig&&selectedOpts.titleFromAlt&&(title=selectedOpts.orig.attr("alt")),href=selectedOpts.href||(obj.nodeName?$(obj).attr("href"):obj.href)||null,!/^(?:javascript)/i.test(href)&&"#"!=href||(href=null),selectedOpts.type?(type=selectedOpts.type,href=href||selectedOpts.content):selectedOpts.content?type="html":href&&(type=href.match(imgRegExp)?"image":href.match(swfRegExp)?"swf":href.match(videoRegExp)?"video":href.match(youtubeRegExp)?(href=href.replace(youtubeRegExp,"$1/embed/$2?$3").replace("/(.*)?$/",""),"iframe"):href.match(youtubeRegExp2)?(parts=href.split("/"),href="//www.youtube.com/embed/"+parts[parts.length-1],"iframe"):href.match(vimeoRegExp)?(href=href.replace(vimeoRegExp,"$1player.vimeo.com/video/$2"),"iframe"):-1!=href.indexOf("http://")&&-1==href.indexOf(location.hostname.toLowerCase())?"iframe":0===href.indexOf("#wk-")?!!window.wk_ajax_render_url&&"widget":0===href.indexOf("#")?"inline":"ajax"),type)switch("inline"==type&&(obj=href.substr(href.indexOf("#")),type=0<$(obj).length?"inline":"ajax"),selectedOpts.type=type,selectedOpts.href=href,selectedOpts.title=title,selectedOpts.autoDimensions&&"iframe"!==selectedOpts.type&&"swf"!==selectedOpts.type&&"video"!==selectedOpts.type&&"widget"!==selectedOpts.type&&(selectedOpts.width="auto",selectedOpts.height="auto"),selectedOpts.modal&&(selectedOpts.overlayShow=!0,selectedOpts.hideOnOverlayClick=!1,selectedOpts.hideOnContentClick=!1,selectedOpts.enableEscapeButton=!1,selectedOpts.showCloseButton=!1),selectedOpts.padding=parseInt(selectedOpts.padding,10),selectedOpts.margin=parseInt(selectedOpts.margin,10),tmp.css("padding",selectedOpts.padding+selectedOpts.margin),$(".lightbox-inline-tmp").unbind("lightbox-cancel").bind("lightbox-change",function(){$(this).replaceWith(content.children())}),type){case"html":tmp.html(selectedOpts.content),_process_inline();break;case"video":busy=!1,selectedOpts.scrolling="no";var vwidth="auto"==selectedOpts.width?320:selectedOpts.width,vheight="auto"==selectedOpts.height?240:selectedOpts.height,vattrs=[];vattrs.push('src="'+href+'"'),vattrs.push('width="'+vwidth+'"'),vattrs.push('height="'+vheight+'"'),vattrs.push('preload="none"'),"undefined"!=$.type(selectedOpts.autoplay)&&vattrs.push('autoplay="'+String(selectedOpts.autoplay)+'"'),"undefined"!=$.type(selectedOpts.controls)&&vattrs.push('controls="'+String(selectedOpts.controls)+'"'),"undefined"!=$.type(selectedOpts.loop)&&vattrs.push('loop="'+String(selectedOpts.loop)+'"'),"undefined"!=$.type(selectedOpts.poster)&&vattrs.push('poster="'+String(selectedOpts.poster)+'"'),tmp.html("<video "+vattrs.join(" ")+" /></video>"),$.fn.mediaelementplayer&&$("video",tmp).each(function(){var t=new mejs.MediaElementPlayer(this);vwidth>$(window).width()&&t.setPlayerSize("100%","100%")}),selectedOpts.width="auto",selectedOpts.height="auto",_process_inline();break;case"inline":if(!0===$(obj).parent().is("#lightbox-content"))return void(busy=!1);$('<div class="lightbox-inline-tmp" />').hide().insertBefore($(obj)).bind("lightbox-cleanup",function(){$(this).replaceWith(content.children())}).bind("lightbox-cancel",function(){$(this).replaceWith(tmp.children())}),$(obj).appendTo(tmp),_process_inline();break;case"image":busy=!1,plugin.showActivity(),imgPreloader=new Image,imgPreloader.onerror=function(){_error()},imgPreloader.onload=function(){busy=!0,imgPreloader.onerror=imgPreloader.onload=null,_process_image()},imgPreloader.src=href;break;case"swf":selectedOpts.scrolling="no",selectedOpts.autoDimensions=!1,str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"><param name="movie" value="'+href+'"></param>',emb="",$.each(selectedOpts.swf,function(t,e){str+='<param name="'+t+'" value="'+e+'"></param>',emb+=" "+t+'="'+e+'"'}),str+='<embed src="'+href+'" type="application/x-shockwave-flash" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"'+emb+"></embed></object>",tmp.html(str),_process_inline();break;case"ajax":busy=!1,plugin.showActivity(),selectedOpts.ajax.win=selectedOpts.ajax.success,ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:href,data:selectedOpts.ajax.data||{},error:function(t,e,r){0<t.status&&_error()},success:function(t,e,r){if(200==("object"==typeof r?r:ajaxLoader).status){if("function"==typeof selectedOpts.ajax.win){if(!1===(ret=selectedOpts.ajax.win(href,t,e,r)))return void loading.hide();"string"!=typeof ret&&"object"!=typeof ret||(t=ret)}tmp.html(t),_process_inline()}}}));break;case"widget":busy=!1,selectedOpts.autoDimensions=!1,plugin.showActivity(),selectedOpts.ajax.win=selectedOpts.ajax.success,ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:wk_ajax_render_url(href.split("-")[1]),data:selectedOpts.ajax.data||{},error:function(t,e,r){0<t.status&&_error()},success:function(t,e,r){if(200==("object"==typeof r?r:ajaxLoader).status){if("function"==typeof selectedOpts.ajax.win){if(!1===(ret=selectedOpts.ajax.win(href,t,e,r)))return void loading.hide();"string"!=typeof ret&&"object"!=typeof ret||(t=ret)}tmp.html(t),_process_inline(),$widgetkit.lazyload($("#lightbox-content"))}}}));break;case"iframe":selectedOpts.autoDimensions=!1,_show()}else _error();else busy=!1},_process_inline=function(){tmp.wrapInner('<div style="width:'+("auto"==selectedOpts.width?"auto":selectedOpts.width+"px")+";height:"+("auto"==selectedOpts.height?"auto":selectedOpts.height+"px")+";overflow: "+("auto"==selectedOpts.scrolling?"auto":"yes"==selectedOpts.scrolling?"scroll":"hidden")+'"></div>'),selectedOpts.width=tmp.width(),selectedOpts.height=tmp.height(),_show()},_process_image=function(){selectedOpts.width=imgPreloader.width,selectedOpts.height=imgPreloader.height,$("<img />").attr({id:"lightbox-img",src:imgPreloader.src,alt:selectedOpts.title}).appendTo(tmp),_show()},_show=function(){var t,e;return loading.hide(),wrap.is(":visible")&&!1===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)?($(".lightbox-inline-tmp").trigger("lightbox-cancel"),void(busy=!1)):(busy=!0,$(content.add(overlay)).unbind(),$(window).unbind("resize.fb scroll.fb"),$(document).unbind("keydown.fb"),wrap.is(":visible")&&"outside"!==currentOpts.titlePosition&&wrap.css("height",wrap.height()),currentArray=selectedArray,currentIndex=selectedIndex,(currentOpts=selectedOpts).overlayShow?(overlay.css({"background-color":currentOpts.overlayColor,opacity:currentOpts.overlayOpacity,cursor:currentOpts.hideOnOverlayClick?"pointer":"auto",height:$(document).height()}),overlay.is(":visible")||overlay.show()):overlay.hide(),final_pos=_get_zoom_to(),_process_title(),wrap.is(":visible")?($(close.add(nav_left).add(nav_right)).hide(),t=wrap.position(),start_pos={top:t.top,left:t.left,width:wrap.width(),height:wrap.height()},e=start_pos.width==final_pos.width&&start_pos.height==final_pos.height,void content.fadeTo(currentOpts.changeFade,.3,function(){function t(){content.html(tmp.contents()).fadeTo(currentOpts.changeFade,1,_finish)}$(".lightbox-inline-tmp").trigger("lightbox-change"),content.empty().removeAttr("filter").css({"border-width":currentOpts.padding,width:final_pos.width-2*currentOpts.padding,height:"image"==currentOpts.type||"swf"==currentOpts.type||"iframe"==currentOpts.type?final_pos.height-titleHeight-2*currentOpts.padding:"auto"}),e?t():(fx.prop=0,$(fx).animate({prop:1},{duration:currentOpts.changeSpeed,easing:currentOpts.easingChange,step:_draw,complete:t}))})):(wrap.removeAttr("style"),content.css("border-width",currentOpts.padding),content.css("-webkit-transform","translateZ(0)"),"elastic"==currentOpts.transitionIn?(start_pos=_get_zoom_from(),content.html(tmp.contents()),wrap.show(),currentOpts.opacity&&(final_pos.opacity=0),fx.prop=0,void $(fx).animate({prop:1},{duration:currentOpts.speedIn,easing:currentOpts.easingIn,step:_draw,complete:_finish})):("inside"==currentOpts.titlePosition&&0<titleHeight&&title.show(),content.css({width:final_pos.width-2*currentOpts.padding,height:"image"==currentOpts.type||"swf"==currentOpts.type||"iframe"==currentOpts.type?final_pos.height-titleHeight-2*currentOpts.padding:"auto"}).html(tmp.contents()),void wrap.css(final_pos).fadeIn("none"==currentOpts.transitionIn?0:currentOpts.speedIn,_finish))))},_format_title=function(t){return!(!t||!t.length)&&'<div id="lightbox-title-'+currentOpts.titlePosition+'">'+t+"</div>"},_process_title=function(){if(titleStr=currentOpts.title||"",titleHeight=0,title.empty().removeAttr("style").removeClass(),!1!==currentOpts.titleShow)if((titleStr=$.isFunction(currentOpts.titleFormat)?currentOpts.titleFormat(titleStr,currentArray,currentIndex,currentOpts):_format_title(titleStr))&&""!==titleStr){switch(title.addClass("lightbox-title-"+currentOpts.titlePosition).html(titleStr).appendTo("body").show(),currentOpts.titlePosition){case"inside":title.css({width:final_pos.width-2*currentOpts.padding,marginLeft:currentOpts.padding,marginRight:currentOpts.padding}),titleHeight=title.outerHeight(!0),title.appendTo(outer),final_pos.height+=titleHeight;break;case"over":title.css({marginLeft:currentOpts.padding,width:final_pos.width-2*currentOpts.padding,bottom:currentOpts.padding}).appendTo(outer);break;case"float":title.css("left",-1*parseInt((title.width()-final_pos.width-40)/2,10)).appendTo(wrap);break;default:title.css({width:final_pos.width-2*currentOpts.padding,paddingLeft:currentOpts.padding,paddingRight:currentOpts.padding}).appendTo(wrap)}title.hide()}else title.hide();else title.hide()},_set_navigation=function(){if((currentOpts.enableEscapeButton||currentOpts.enableKeyboardNav)&&$(document).bind("keydown.fb",function(t){27==t.keyCode&&currentOpts.enableEscapeButton?(t.preventDefault(),plugin.close()):37!=t.keyCode&&39!=t.keyCode||!currentOpts.enableKeyboardNav||"INPUT"===t.target.tagName||"TEXTAREA"===t.target.tagName||"SELECT"===t.target.tagName||(t.preventDefault(),plugin[37==t.keyCode?"prev":"next"]())}),!currentOpts.showNavArrows)return nav_left.hide(),void nav_right.hide();(currentOpts.cyclic&&1<currentArray.length||0!==currentIndex)&&nav_left.show(),(currentOpts.cyclic&&1<currentArray.length||currentIndex!=currentArray.length-1)&&nav_right.show()},_finish=function(){$.support.opacity||(content.get(0).style.removeAttribute("filter"),wrap.get(0).style.removeAttribute("filter")),wrap.css("height","auto"),"image"!==currentOpts.type&&"swf"!==currentOpts.type&&"iframe"!==currentOpts.type&&content.css("height","auto"),titleStr&&titleStr.length&&title.show(),currentOpts.showCloseButton&&close.show(),_set_navigation(),currentOpts.hideOnContentClick&&content.bind("click",plugin.close),currentOpts.hideOnOverlayClick&&overlay.bind("click",plugin.close),$(window).bind("resize.fb",plugin.resize),currentOpts.centerOnScroll&&$(window).bind("scroll.fb",plugin.center),"iframe"==currentOpts.type&&$('<iframe id="lightbox-frame" name="lightbox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" '+($.support.opacity?"":'allowtransparency="true""')+' scrolling="'+selectedOpts.scrolling+'" src="'+currentOpts.href+'"></iframe>').appendTo(content),wrap.show(),busy=!1,plugin.center(),("string"==typeof currentOpts.onComplete?window[currentOpts.onComplete]:currentOpts.onComplete)(currentArray,currentIndex,currentOpts),_preload_images()},_preload_images=function(){var t;currentArray.length-1>currentIndex&&void 0!==(t=currentArray[currentIndex+1].href)&&t.match(imgRegExp)&&((new Image).src=t),0<currentIndex&&void 0!==(t=currentArray[currentIndex-1].href)&&t.match(imgRegExp)&&((new Image).src=t)},_draw=function(t){var e={width:parseInt(start_pos.width+(final_pos.width-start_pos.width)*t,10),height:parseInt(start_pos.height+(final_pos.height-start_pos.height)*t,10),top:parseInt(start_pos.top+(final_pos.top-start_pos.top)*t,10),left:parseInt(start_pos.left+(final_pos.left-start_pos.left)*t,10)};void 0!==final_pos.opacity&&(e.opacity=t<.5?.5:t),wrap.css(e),content.css({width:e.width-2*currentOpts.padding,height:e.height-titleHeight*t-2*currentOpts.padding})},_get_viewport=function(){return[$(window).width()-2*currentOpts.margin,$(window).height()-2*currentOpts.margin,$(document).scrollLeft()+currentOpts.margin,$(document).scrollTop()+currentOpts.margin]},_get_zoom_to=function(){var t,e=_get_viewport(),r={},i=currentOpts.autoScale,n=2*currentOpts.padding;return-1<currentOpts.width.toString().indexOf("%")?r.width=parseInt(e[0]*parseFloat(currentOpts.width)/100,10):r.width=parseInt(currentOpts.width)+n,-1<currentOpts.height.toString().indexOf("%")?r.height=parseInt(e[1]*parseFloat(currentOpts.height)/100,10):r.height=parseInt(currentOpts.height)+n,i&&(r.width>e[0]||r.height>e[1])&&("image"==selectedOpts.type||"swf"==selectedOpts.type?(t=currentOpts.width/currentOpts.height,r.width>e[0]&&(r.width=e[0],r.height=parseInt((r.width-n)/t+n,10)),r.height>e[1]&&(r.height=e[1],r.width=parseInt((r.height-n)*t+n,10))):(r.width=Math.min(r.width,e[0]),r.height=Math.min(r.height,e[1]))),r.top=parseInt(Math.max(e[3]-20,e[3]+.5*(e[1]-r.height-40)),10),r.left=parseInt(Math.max(e[2]-20,e[2]+.5*(e[0]-r.width-40)),10),r},_get_obj_pos=function(t){var e=t.offset();return e.top+=parseInt(t.css("paddingTop"),10)||0,e.left+=parseInt(t.css("paddingLeft"),10)||0,e.top+=parseInt(t.css("border-top-width"),10)||0,e.left+=parseInt(t.css("border-left-width"),10)||0,e.width=t.width(),e.height=t.height(),e},_get_zoom_from=function(){var t,e,r=!!selectedOpts.orig&&$(selectedOpts.orig);return r&&r.length?{width:(t=_get_obj_pos(r)).width+2*currentOpts.padding,height:t.height+2*currentOpts.padding,top:t.top-currentOpts.padding-20,left:t.left-currentOpts.padding-20}:(e=_get_viewport(),{width:2*currentOpts.padding,height:2*currentOpts.padding,top:parseInt(e[3]+.5*e[1],10),left:parseInt(e[2]+.5*e[0],10)})},_animate_loading=function(){loading.is(":visible")?($("div",loading).css("top",-40*loadingFrame+"px"),loadingFrame=(loadingFrame+1)%12):clearInterval(loadingTimer)};var Plugin=function(){};Plugin.prototype=$.extend(Plugin.prototype,{name:"lightbox",defaults:{padding:10,margin:40,opacity:!1,modal:!1,cyclic:!1,scrolling:"auto",width:560,height:340,autoScale:!0,autoDimensions:!0,centerOnScroll:!1,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:!0,hideOnContentClick:!1,overlayShow:!0,overlayOpacity:.7,overlayColor:"#777",titleShow:!0,titlePosition:"float",titleFormat:null,titleFromAlt:!1,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:!0,showNavArrows:!0,enableEscapeButton:!0,enableKeyboardNav:!0,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}},init:function(){var r=this;$("#lightbox-wrap").length||($("body").append(tmp=$('<div id="lightbox-tmp"></div>'),loading=$('<div id="lightbox-loading"><div></div></div>'),overlay=$('<div id="lightbox-overlay"></div>'),wrap=$('<div id="lightbox-wrap"></div>')),body_margin=overlay.show().position(),overlay.hide(),0!=body_margin.top&&overlay.css("top",-1*body_margin.top),(outer=$('<div id="lightbox-outer"></div>').appendTo(wrap)).append(content=$('<div id="lightbox-content"></div>'),close=$('<a id="lightbox-close"></a>'),title=$('<div id="lightbox-title"></div>'),nav_left=$('<a href="javascript:;" id="lightbox-left"><span id="lightbox-left-ico"></span></a>'),nav_right=$('<a href="javascript:;" id="lightbox-right"><span id="lightbox-right-ico"></span></a>')),close.bind("click",this.close),loading.bind("click",this.cancel),nav_left.bind("click",function(t){t.preventDefault(),r.prev()}),nav_right.bind("click",function(t){t.preventDefault(),r.next()}),$.fn.mousewheel&&wrap.bind("mousewheel.fb",function(t,e){!busy&&"image"!=currentOpts.type||t.preventDefault(),r[0<e?"prev":"next"]()}),"ontouchend"in document&&(wrap.bind("touchstart",function(t){var r,e=t.originalEvent.touches?t.originalEvent.touches[0]:t,i={time:(new Date).getTime(),coords:[e.pageX,e.pageY],origin:$(t.target)};function n(t){var e;i&&(e=t.originalEvent.touches?t.originalEvent.touches[0]:t,r={time:(new Date).getTime(),coords:[e.pageX,e.pageY]},10<Math.abs(i.coords[0]-r.coords[0])&&t.preventDefault())}wrap.bind("touchmove",n).one("touchend",function(t){wrap.unbind("touchmove",n),i&&r&&r.time-i.time<1e3&&30<Math.abs(i.coords[0]-r.coords[0])&&Math.abs(i.coords[1]-r.coords[1])<75&&i.origin.trigger("swipe").trigger(i.coords[0]>r.coords[0]?"swipeleft":"swiperight"),i=r=void 0})}),wrap.bind("swipeleft",function(t){!busy&&"image"!=currentOpts.type||t.preventDefault(),r.next()}).bind("swiperight",function(t){!busy&&"image"!=currentOpts.type||t.preventDefault(),r.prev()})))},open:function(t){var e;if(!busy){if(busy=!0,e=void 0!==arguments[1]?arguments[1]:{},selectedArray=[],selectedIndex=parseInt(e.index,10)||0,$.isArray(t)){for(var r=0,i=t.length;r<i;r++)"object"==typeof t[r]?$(t[r]).data(plugin.name,$.extend({},e,t[r])):t[r]=$({}).data(plugin.name,$.extend({content:t[r]},e));selectedArray=$.merge(selectedArray,t)}else"object"==typeof t?$(t).data(plugin.name,$.extend({},e,t)):t=$({}).data(plugin.name,$.extend({content:t},e)),selectedArray.push(t);(selectedIndex>selectedArray.length||selectedIndex<0)&&(selectedIndex=0),_start()}},showActivity:function(){clearInterval(loadingTimer),loading.show(),loadingTimer=setInterval(_animate_loading,66)},hideActivity:function(){loading.hide()},next:function(){return this.pos(currentIndex+1)},prev:function(){return this.pos(currentIndex-1)},pos:function(t){busy||(t=parseInt(t),selectedArray=currentArray,-1<t&&t<currentArray.length?(selectedIndex=t,_start()):currentOpts.cyclic&&1<currentArray.length&&(selectedIndex=t>=currentArray.length?0:currentArray.length-1,_start()))},cancel:function(){busy||(busy=!0,$(".lightbox-inline-tmp").trigger("lightbox-cancel"),_abort(),selectedOpts.onCancel(selectedArray,selectedIndex,selectedOpts),busy=!1)},close:function(){var t;function e(){overlay.fadeOut("fast"),title.empty().hide(),wrap.hide(),$(".lightbox-inline-tmp").trigger("lightbox-cleanup"),content.empty(),currentOpts.onClosed(currentArray,currentIndex,currentOpts),currentArray=selectedOpts=[],currentIndex=selectedIndex=0,currentOpts=selectedOpts={},busy=!1}busy||wrap.is(":hidden")||(busy=!0,currentOpts&&!1===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)?busy=!1:(_abort(),$(close.add(nav_left).add(nav_right)).hide(),$(content.add(overlay)).unbind(),$(window).unbind("resize.fb scroll.fb"),$(document).unbind("keydown.fb"),content.find("iframe").attr("src","about:blank"),"inside"!==currentOpts.titlePosition&&title.empty(),wrap.stop(),"elastic"==currentOpts.transitionOut?(start_pos=_get_zoom_from(),t=wrap.position(),final_pos={top:t.top,left:t.left,width:wrap.width(),height:wrap.height()},currentOpts.opacity&&(final_pos.opacity=1),title.empty().hide(),fx.prop=1,$(fx).animate({prop:0},{duration:currentOpts.speedOut,easing:currentOpts.easingOut,step:_draw,complete:e})):wrap.fadeOut("none"==currentOpts.transitionOut?0:currentOpts.speedOut,e)))},resize:function(){overlay.is(":visible")&&overlay.css("height",$(document).height()),final_pos=_get_zoom_to(),"float"===currentOpts.titlePosition?title.css("left",-1*parseInt((title.width()-final_pos.width-40)/2,10)):title.css("width",final_pos.width-2*currentOpts.padding),plugin.center(!0)},center:function(){var t,e;busy||(e=!0===arguments[0]?1:0,t=_get_viewport(),!e&&(wrap.width()>t[0]||wrap.height()>t[1])||wrap.stop().animate({top:parseInt(Math.max(t[3]-20,t[3]+.5*(t[1]-content.height()-40)-currentOpts.padding)),left:parseInt(Math.max(t[2]-20,t[2]+.5*(t[0]-content.width()-40)-currentOpts.padding))},"number"==typeof arguments[0]?arguments[0]:200))}}),$.fn[Plugin.prototype.name]=function(){var t=arguments,e=t[0]?t[0]:{};return this.each(function(){$(this).data(Plugin.prototype.name,e).unbind("click."+Plugin.prototype.name).bind("click."+Plugin.prototype.name,function(t){var e;t.preventDefault(),busy||(busy=!0,$(this).blur(),selectedArray=[],selectedIndex=0,(e=(e=$(this).attr("data-lightbox")||"")&&e.match(/group:([^;]+)/i))?(selectedArray=$('a[data-lightbox*="'+e[0]+'"], area[data-lightbox*="'+e[0]+'"]'),selectedIndex=selectedArray.index(this)):selectedArray.push(this),_start())})})},$(document).ready(function(){(plugin=new Plugin).init(),$[Plugin.prototype.name]=plugin})}(jQuery);