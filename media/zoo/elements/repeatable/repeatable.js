/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(l){function i(){}l.extend(i.prototype,{name:"ElementRepeatable",options:{msgDeleteElement:null,msgSortElement:null},initialize:function(e,t){this.options=l.extend({},this.options,t);var n=this,a=e.find("ul.repeatable-list"),i=a.find("li.hidden").remove(),o=a.find("li.repeatable-element").length;a.find("li.repeatable-element").each(function(){n.attachButtons(l(this))}),a.delegate("span.sort","mousedown",function(){a.find(".more-options.show-advanced").removeClass("show-advanced")}).delegate("span.delete","click",function(){l(this).closest("li.repeatable-element").fadeOut(200,function(){l(this).remove()})}).sortable({handle:"span.sort",placeholder:"repeatable-element dragging",axis:"y",opacity:1,delay:100,cursorAt:{top:16},tolerance:"pointer",containment:"parent",scroll:!1,start:function(e,t){t.item.addClass("ghost"),t.placeholder.height(t.item.height()-2),t.placeholder.width(t.item.find("div.repeatable-content").width()-2)},stop:function(e,t){t.item.removeClass("ghost")}}),e.find("p.add a").bind("click",function(){var e=l("<li>").addClass("repeatable-element").html(i.html().replace(/(elements\[\S+])\[(-?\d+)\]/g,"$1["+o+++"]"));n.attachButtons(e),e.appendTo(a),e.find('input:not([type="radio"]), :not([type="checkbox"])').each(function(){l(this).val()&&l(this).val("")}),e.children("div.repeatable-content").effect("highlight",{},1e3)})},attachButtons:function(e){e.children().wrapAll(l("<div>").addClass("repeatable-content")),l("<span>").addClass("sort").attr("title",this.options.msgSortElement).appendTo(e),l("<span>").addClass("delete").attr("title",this.options.msgDeleteElement).appendTo(e)}}),l.fn[i.prototype.name]=function(){var n=arguments,a=n[0]?n[0]:null;return this.each(function(){var e,t=l(this);i.prototype[a]&&t.data(i.prototype.name)&&"initialize"!=a?t.data(i.prototype.name)[a].apply(t.data(i.prototype.name),Array.prototype.slice.call(n,1)):!a||l.isPlainObject(a)?(e=new i,i.prototype.initialize&&e.initialize.apply(e,l.merge([t],n)),t.data(i.prototype.name,e)):l.error("Method "+a+" does not exist on jQuery."+i.name)})}}(jQuery);