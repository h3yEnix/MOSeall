/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(c){function e(){}e.prototype=c.extend(e.prototype,{name:"ApplicationEdit",options:{url:"index.php?option=com_zoo&controller=configuration",config_url:"index.php?option=com_config&task=config.store&format=raw",application_id:0,application_group:""},initialize:function(t,a){this.options=c.extend({},this.options,a);var o=this,i=c("#parameter-accordion"),e=c("#template"),n=c("#zoo-permissions");e.bind("change",function(){var a=c('<span class="loader">').insertAfter(e);i.fadeOut(),c.ajax({url:o.options.url,data:{task:"getApplicationParams",format:"raw","cid[]":o.options.application_id,group:o.options.application_group,template:c(this).val()},success:function(t){i.html(t).fadeIn().accordionMenu({mode:"slide",display:0}),a.remove()}})}),n.find("select").change(function(){o.sendPermissions(this)})},sendPermissions:function(t){var a=c(t),i=c(document.getElementById("icon_"+a.attr("id"))),o="com_zoo.application."+this.options.application_id,e=c("input[name=alias]").val(),n=a.val(),s=a.attr("id").split("_"),r="application"!==s[1]&&s[1],l="GET",p=c("#zoo-permissions [data-ajaxuri]:first");!1!==r&&(o+="."+r,e+=" ("+r+")"),i.attr("class",""),i.attr("style","background: url(../media/system/images/modal/spinner.gif); display: inline-block; width: 16px; height: 16px"),p.length&&(l="POST",this.options.config_url=p.data("ajaxuri")),c.ajax({method:l,url:this.options.config_url,datatype:"json",data:{comp:o,action:s[2],rule:s[3],value:n,title:e}}).fail(function(t,a,o){i.attr("style",""),Joomla.renderMessages(Joomla.ajaxErrorsMessages(t,a,o)),window.scrollTo(0,0),i.attr("class","icon-cancel")}).done(function(t){i.attr("style",""),t.data&&1==t.data.result&&(i.attr("class","icon-save"),a.parents().next("td").find("span").attr("class",t.data.class).html(t.data.text)),"object"==typeof t.messages&&null!==t.messages&&(Joomla.renderMessages(t.messages),t.data&&1==t.data.result?i.attr("class","icon-save"):i.attr("class","icon-cancel"),window.scrollTo(0,0))})}}),c.fn[e.prototype.name]=function(){var o=arguments,i=o[0]?o[0]:null;return this.each(function(){var t,a=c(this);e.prototype[i]&&a.data(e.prototype.name)&&"initialize"!=i?a.data(e.prototype.name)[i].apply(a.data(e.prototype.name),Array.prototype.slice.call(o,1)):!i||c.isPlainObject(i)?(t=new e,e.prototype.initialize&&t.initialize.apply(t,c.merge([a],o)),a.data(e.prototype.name,t)):c.error("Method "+i+" does not exist on jQuery."+e.name)})}}(jQuery);