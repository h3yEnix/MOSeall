/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

!function(o){function i(){}i.prototype=o.extend(i.prototype,{name:"Update",options:{msgPerformingUpdate:"Performing Update...",msgFinished:"Update successfull...Reload page to continue working.",msgError:"Error during update. Please visit the YOOtheme support forums."},initialize:function(e,t){this.options=o.extend({},this.options,t);var s=this;(this.form=e).find("button.update").bind("click",function(){o(this).parent().remove(),s.step()})},step:function(){var s=this.form,a=this;o.ajax({url:s.attr("action"),type:"post",datatype:"json",data:s.serialize(),beforeSend:function(){a.addMessage(a.options.msgPerformingUpdate,"loading")},success:function(t){try{t=o.parseJSON(t)}catch(e){t={error:!0,message:t}}s.find("div.message-box").find("div.message").last().removeClass("loading"),t.error?a.addMessage(t.message,"error"):(a.addMessage(t.message),t.continue?a.step():a.addMessage(a.options.msgFinished,"success"))},error:function(e,t){s.find("div.message-box").find("div.message").last().removeClass("loading"),a.addMessage(t,"error")}})},addMessage:function(e,t){e=o('<div class="message">').text(e).appendTo(this.form.find("div.message-box"));t&&e.addClass(t)}}),o.fn[i.prototype.name]=function(){var s=arguments,a=s[0]?s[0]:null;return this.each(function(){var e,t=o(this);i.prototype[a]&&t.data(i.prototype.name)&&"initialize"!=a?t.data(i.prototype.name)[a].apply(t.data(i.prototype.name),Array.prototype.slice.call(s,1)):!a||o.isPlainObject(a)?(e=new i,i.prototype.initialize&&e.initialize.apply(e,o.merge([t],s)),t.data(i.prototype.name,e)):o.error("Method "+a+" does not exist on jQuery."+i.name)})}}(jQuery);